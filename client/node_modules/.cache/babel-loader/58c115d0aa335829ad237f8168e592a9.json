{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || Object.assign || function (t) {\n  for (var s, i = 1, n = arguments.length; i < n; i++) {\n    s = arguments[i];\n\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n  }\n\n  return t;\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : new P(function (resolve) {\n        resolve(result.value);\n      }).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [0, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar utils_1 = require(\"@0xproject/utils\");\n\nvar _ = require(\"lodash\");\n\nvar Web3 = require(\"web3\");\n\nvar Web3Wrapper =\n/** @class */\nfunction () {\n  function Web3Wrapper(provider, defaults) {\n    if (_.isUndefined(provider.sendAsync)) {\n      // Web3@1.0 provider doesn't support synchronous http requests,\n      // so it only has an async `send` method, instead of a `send` and `sendAsync` in web3@0.x.x`\n      // We re-assign the send method so that Web3@1.0 providers work with 0x.js\n      provider.sendAsync = provider.send;\n    }\n\n    this._web3 = new Web3();\n\n    this._web3.setProvider(provider);\n\n    this._defaults = defaults || {};\n    this._jsonRpcRequestId = 0;\n  }\n\n  Web3Wrapper.prototype.getContractDefaults = function () {\n    return this._defaults;\n  };\n\n  Web3Wrapper.prototype.setProvider = function (provider) {\n    this._web3.setProvider(provider);\n  };\n\n  Web3Wrapper.prototype.isAddress = function (address) {\n    return this._web3.isAddress(address);\n  };\n\n  Web3Wrapper.prototype.isSenderAddressAvailableAsync = function (senderAddress) {\n    return __awaiter(this, void 0, void 0, function () {\n      var addresses;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.getAvailableAddressesAsync()];\n\n          case 1:\n            addresses = _a.sent();\n            return [2\n            /*return*/\n            , _.includes(addresses, senderAddress)];\n        }\n      });\n    });\n  };\n\n  Web3Wrapper.prototype.getNodeVersionAsync = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var nodeVersion;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , utils_1.promisify(this._web3.version.getNode)()];\n\n          case 1:\n            nodeVersion = _a.sent();\n            return [2\n            /*return*/\n            , nodeVersion];\n        }\n      });\n    });\n  };\n\n  Web3Wrapper.prototype.getNetworkIdAsync = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var networkIdStr, networkId;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , utils_1.promisify(this._web3.version.getNetwork)()];\n\n          case 1:\n            networkIdStr = _a.sent();\n            networkId = _.parseInt(networkIdStr);\n            return [2\n            /*return*/\n            , networkId];\n        }\n      });\n    });\n  };\n\n  Web3Wrapper.prototype.getTransactionReceiptAsync = function (txHash) {\n    return __awaiter(this, void 0, void 0, function () {\n      var transactionReceipt;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , utils_1.promisify(this._web3.eth.getTransactionReceipt)(txHash)];\n\n          case 1:\n            transactionReceipt = _a.sent();\n\n            if (!_.isNull(transactionReceipt)) {\n              transactionReceipt.status = this._normalizeTxReceiptStatus(transactionReceipt.status);\n            }\n\n            return [2\n            /*return*/\n            , transactionReceipt];\n        }\n      });\n    });\n  };\n\n  Web3Wrapper.prototype.getCurrentProvider = function () {\n    return this._web3.currentProvider;\n  };\n\n  Web3Wrapper.prototype.toWei = function (ethAmount) {\n    var balanceWei = this._web3.toWei(ethAmount, 'ether');\n\n    return balanceWei;\n  };\n\n  Web3Wrapper.prototype.getBalanceInWeiAsync = function (owner) {\n    return __awaiter(this, void 0, void 0, function () {\n      var balanceInWei;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , utils_1.promisify(this._web3.eth.getBalance)(owner)];\n\n          case 1:\n            balanceInWei = _a.sent(); // Rewrap in a new BigNumber\n\n            balanceInWei = new utils_1.BigNumber(balanceInWei);\n            return [2\n            /*return*/\n            , balanceInWei];\n        }\n      });\n    });\n  };\n\n  Web3Wrapper.prototype.doesContractExistAtAddressAsync = function (address) {\n    return __awaiter(this, void 0, void 0, function () {\n      var code, codeIsEmpty;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , utils_1.promisify(this._web3.eth.getCode)(address)];\n\n          case 1:\n            code = _a.sent();\n            codeIsEmpty = /^0x0{0,40}$/i.test(code);\n            return [2\n            /*return*/\n            , !codeIsEmpty];\n        }\n      });\n    });\n  };\n\n  Web3Wrapper.prototype.signTransactionAsync = function (address, message) {\n    return __awaiter(this, void 0, void 0, function () {\n      var signData;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , utils_1.promisify(this._web3.eth.sign)(address, message)];\n\n          case 1:\n            signData = _a.sent();\n            return [2\n            /*return*/\n            , signData];\n        }\n      });\n    });\n  };\n\n  Web3Wrapper.prototype.getBlockNumberAsync = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var blockNumber;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , utils_1.promisify(this._web3.eth.getBlockNumber)()];\n\n          case 1:\n            blockNumber = _a.sent();\n            return [2\n            /*return*/\n            , blockNumber];\n        }\n      });\n    });\n  };\n\n  Web3Wrapper.prototype.getBlockAsync = function (blockParam) {\n    return __awaiter(this, void 0, void 0, function () {\n      var block;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , utils_1.promisify(this._web3.eth.getBlock)(blockParam)];\n\n          case 1:\n            block = _a.sent();\n            return [2\n            /*return*/\n            , block];\n        }\n      });\n    });\n  };\n\n  Web3Wrapper.prototype.getBlockTimestampAsync = function (blockParam) {\n    return __awaiter(this, void 0, void 0, function () {\n      var timestamp;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.getBlockAsync(blockParam)];\n\n          case 1:\n            timestamp = _a.sent().timestamp;\n            return [2\n            /*return*/\n            , timestamp];\n        }\n      });\n    });\n  };\n\n  Web3Wrapper.prototype.getAvailableAddressesAsync = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var addresses;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , utils_1.promisify(this._web3.eth.getAccounts)()];\n\n          case 1:\n            addresses = _a.sent();\n            return [2\n            /*return*/\n            , addresses];\n        }\n      });\n    });\n  };\n\n  Web3Wrapper.prototype.getLogsAsync = function (filter) {\n    return __awaiter(this, void 0, void 0, function () {\n      var fromBlock, toBlock, serializedFilter, payload, rawLogs, formattedLogs;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            fromBlock = filter.fromBlock;\n\n            if (_.isNumber(fromBlock)) {\n              fromBlock = this._web3.toHex(fromBlock);\n            }\n\n            toBlock = filter.toBlock;\n\n            if (_.isNumber(toBlock)) {\n              toBlock = this._web3.toHex(toBlock);\n            }\n\n            serializedFilter = __assign({}, filter, {\n              fromBlock: fromBlock,\n              toBlock: toBlock\n            });\n            payload = {\n              jsonrpc: '2.0',\n              id: this._jsonRpcRequestId++,\n              method: 'eth_getLogs',\n              params: [serializedFilter]\n            };\n            return [4\n            /*yield*/\n            , this._sendRawPayloadAsync(payload)];\n\n          case 1:\n            rawLogs = _a.sent();\n            formattedLogs = _.map(rawLogs, this._formatLog.bind(this));\n            return [2\n            /*return*/\n            , formattedLogs];\n        }\n      });\n    });\n  };\n\n  Web3Wrapper.prototype.getContractFromAbi = function (abi) {\n    var web3Contract = this._web3.eth.contract(abi);\n\n    return web3Contract;\n  };\n\n  Web3Wrapper.prototype.getContractInstance = function (abi, address) {\n    var web3ContractInstance = this.getContractFromAbi(abi).at(address);\n    return web3ContractInstance;\n  };\n\n  Web3Wrapper.prototype.estimateGasAsync = function (data) {\n    return __awaiter(this, void 0, void 0, function () {\n      var gas;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , utils_1.promisify(this._web3.eth.estimateGas)({\n              data: data\n            })];\n\n          case 1:\n            gas = _a.sent();\n            return [2\n            /*return*/\n            , gas];\n        }\n      });\n    });\n  };\n\n  Web3Wrapper.prototype.sendTransactionAsync = function (txData) {\n    return __awaiter(this, void 0, void 0, function () {\n      var txHash;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , utils_1.promisify(this._web3.eth.sendTransaction)(txData)];\n\n          case 1:\n            txHash = _a.sent();\n            return [2\n            /*return*/\n            , txHash];\n        }\n      });\n    });\n  };\n\n  Web3Wrapper.prototype._sendRawPayloadAsync = function (payload) {\n    return __awaiter(this, void 0, void 0, function () {\n      var sendAsync, response, result;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            sendAsync = this._web3.currentProvider.sendAsync.bind(this._web3.currentProvider);\n            return [4\n            /*yield*/\n            , utils_1.promisify(sendAsync)(payload)];\n\n          case 1:\n            response = _a.sent();\n            result = response.result;\n            return [2\n            /*return*/\n            , result];\n        }\n      });\n    });\n  };\n\n  Web3Wrapper.prototype._normalizeTxReceiptStatus = function (status) {\n    // Transaction status might have four values\n    // undefined - Testrpc and other old clients\n    // null - New clients on old transactions\n    // number - Parity\n    // hex - Geth\n    if (_.isString(status)) {\n      return this._web3.toDecimal(status);\n    } else if (_.isUndefined(status)) {\n      return null;\n    } else {\n      return status;\n    }\n  };\n\n  Web3Wrapper.prototype._formatLog = function (rawLog) {\n    var formattedLog = __assign({}, rawLog, {\n      logIndex: this._hexToDecimal(rawLog.logIndex),\n      blockNumber: this._hexToDecimal(rawLog.blockNumber),\n      transactionIndex: this._hexToDecimal(rawLog.transactionIndex)\n    });\n\n    return formattedLog;\n  };\n\n  Web3Wrapper.prototype._hexToDecimal = function (hex) {\n    if (_.isNull(hex)) {\n      return null;\n    }\n\n    var decimal = this._web3.toDecimal(hex);\n\n    return decimal;\n  };\n\n  return Web3Wrapper;\n}();\n\nexports.Web3Wrapper = Web3Wrapper;","map":{"version":3,"sources":["../src/index.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || Object.assign || function(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n        s = arguments[i];\n        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n            t[p] = s[p];\n    }\n    return t;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = y[op[0] & 2 ? \"return\" : op[0] ? \"throw\" : \"next\"]) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [0, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar utils_1 = require(\"@0xproject/utils\");\nvar _ = require(\"lodash\");\nvar Web3 = require(\"web3\");\nvar Web3Wrapper = /** @class */ (function () {\n    function Web3Wrapper(provider, defaults) {\n        if (_.isUndefined(provider.sendAsync)) {\n            // Web3@1.0 provider doesn't support synchronous http requests,\n            // so it only has an async `send` method, instead of a `send` and `sendAsync` in web3@0.x.x`\n            // We re-assign the send method so that Web3@1.0 providers work with 0x.js\n            provider.sendAsync = provider.send;\n        }\n        this._web3 = new Web3();\n        this._web3.setProvider(provider);\n        this._defaults = defaults || {};\n        this._jsonRpcRequestId = 0;\n    }\n    Web3Wrapper.prototype.getContractDefaults = function () {\n        return this._defaults;\n    };\n    Web3Wrapper.prototype.setProvider = function (provider) {\n        this._web3.setProvider(provider);\n    };\n    Web3Wrapper.prototype.isAddress = function (address) {\n        return this._web3.isAddress(address);\n    };\n    Web3Wrapper.prototype.isSenderAddressAvailableAsync = function (senderAddress) {\n        return __awaiter(this, void 0, void 0, function () {\n            var addresses;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.getAvailableAddressesAsync()];\n                    case 1:\n                        addresses = _a.sent();\n                        return [2 /*return*/, _.includes(addresses, senderAddress)];\n                }\n            });\n        });\n    };\n    Web3Wrapper.prototype.getNodeVersionAsync = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var nodeVersion;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, utils_1.promisify(this._web3.version.getNode)()];\n                    case 1:\n                        nodeVersion = _a.sent();\n                        return [2 /*return*/, nodeVersion];\n                }\n            });\n        });\n    };\n    Web3Wrapper.prototype.getNetworkIdAsync = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var networkIdStr, networkId;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, utils_1.promisify(this._web3.version.getNetwork)()];\n                    case 1:\n                        networkIdStr = _a.sent();\n                        networkId = _.parseInt(networkIdStr);\n                        return [2 /*return*/, networkId];\n                }\n            });\n        });\n    };\n    Web3Wrapper.prototype.getTransactionReceiptAsync = function (txHash) {\n        return __awaiter(this, void 0, void 0, function () {\n            var transactionReceipt;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, utils_1.promisify(this._web3.eth.getTransactionReceipt)(txHash)];\n                    case 1:\n                        transactionReceipt = _a.sent();\n                        if (!_.isNull(transactionReceipt)) {\n                            transactionReceipt.status = this._normalizeTxReceiptStatus(transactionReceipt.status);\n                        }\n                        return [2 /*return*/, transactionReceipt];\n                }\n            });\n        });\n    };\n    Web3Wrapper.prototype.getCurrentProvider = function () {\n        return this._web3.currentProvider;\n    };\n    Web3Wrapper.prototype.toWei = function (ethAmount) {\n        var balanceWei = this._web3.toWei(ethAmount, 'ether');\n        return balanceWei;\n    };\n    Web3Wrapper.prototype.getBalanceInWeiAsync = function (owner) {\n        return __awaiter(this, void 0, void 0, function () {\n            var balanceInWei;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, utils_1.promisify(this._web3.eth.getBalance)(owner)];\n                    case 1:\n                        balanceInWei = _a.sent();\n                        // Rewrap in a new BigNumber\n                        balanceInWei = new utils_1.BigNumber(balanceInWei);\n                        return [2 /*return*/, balanceInWei];\n                }\n            });\n        });\n    };\n    Web3Wrapper.prototype.doesContractExistAtAddressAsync = function (address) {\n        return __awaiter(this, void 0, void 0, function () {\n            var code, codeIsEmpty;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, utils_1.promisify(this._web3.eth.getCode)(address)];\n                    case 1:\n                        code = _a.sent();\n                        codeIsEmpty = /^0x0{0,40}$/i.test(code);\n                        return [2 /*return*/, !codeIsEmpty];\n                }\n            });\n        });\n    };\n    Web3Wrapper.prototype.signTransactionAsync = function (address, message) {\n        return __awaiter(this, void 0, void 0, function () {\n            var signData;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, utils_1.promisify(this._web3.eth.sign)(address, message)];\n                    case 1:\n                        signData = _a.sent();\n                        return [2 /*return*/, signData];\n                }\n            });\n        });\n    };\n    Web3Wrapper.prototype.getBlockNumberAsync = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var blockNumber;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, utils_1.promisify(this._web3.eth.getBlockNumber)()];\n                    case 1:\n                        blockNumber = _a.sent();\n                        return [2 /*return*/, blockNumber];\n                }\n            });\n        });\n    };\n    Web3Wrapper.prototype.getBlockAsync = function (blockParam) {\n        return __awaiter(this, void 0, void 0, function () {\n            var block;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, utils_1.promisify(this._web3.eth.getBlock)(blockParam)];\n                    case 1:\n                        block = _a.sent();\n                        return [2 /*return*/, block];\n                }\n            });\n        });\n    };\n    Web3Wrapper.prototype.getBlockTimestampAsync = function (blockParam) {\n        return __awaiter(this, void 0, void 0, function () {\n            var timestamp;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.getBlockAsync(blockParam)];\n                    case 1:\n                        timestamp = (_a.sent()).timestamp;\n                        return [2 /*return*/, timestamp];\n                }\n            });\n        });\n    };\n    Web3Wrapper.prototype.getAvailableAddressesAsync = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var addresses;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, utils_1.promisify(this._web3.eth.getAccounts)()];\n                    case 1:\n                        addresses = _a.sent();\n                        return [2 /*return*/, addresses];\n                }\n            });\n        });\n    };\n    Web3Wrapper.prototype.getLogsAsync = function (filter) {\n        return __awaiter(this, void 0, void 0, function () {\n            var fromBlock, toBlock, serializedFilter, payload, rawLogs, formattedLogs;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        fromBlock = filter.fromBlock;\n                        if (_.isNumber(fromBlock)) {\n                            fromBlock = this._web3.toHex(fromBlock);\n                        }\n                        toBlock = filter.toBlock;\n                        if (_.isNumber(toBlock)) {\n                            toBlock = this._web3.toHex(toBlock);\n                        }\n                        serializedFilter = __assign({}, filter, { fromBlock: fromBlock,\n                            toBlock: toBlock });\n                        payload = {\n                            jsonrpc: '2.0',\n                            id: this._jsonRpcRequestId++,\n                            method: 'eth_getLogs',\n                            params: [serializedFilter],\n                        };\n                        return [4 /*yield*/, this._sendRawPayloadAsync(payload)];\n                    case 1:\n                        rawLogs = _a.sent();\n                        formattedLogs = _.map(rawLogs, this._formatLog.bind(this));\n                        return [2 /*return*/, formattedLogs];\n                }\n            });\n        });\n    };\n    Web3Wrapper.prototype.getContractFromAbi = function (abi) {\n        var web3Contract = this._web3.eth.contract(abi);\n        return web3Contract;\n    };\n    Web3Wrapper.prototype.getContractInstance = function (abi, address) {\n        var web3ContractInstance = this.getContractFromAbi(abi).at(address);\n        return web3ContractInstance;\n    };\n    Web3Wrapper.prototype.estimateGasAsync = function (data) {\n        return __awaiter(this, void 0, void 0, function () {\n            var gas;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, utils_1.promisify(this._web3.eth.estimateGas)({ data: data })];\n                    case 1:\n                        gas = _a.sent();\n                        return [2 /*return*/, gas];\n                }\n            });\n        });\n    };\n    Web3Wrapper.prototype.sendTransactionAsync = function (txData) {\n        return __awaiter(this, void 0, void 0, function () {\n            var txHash;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, utils_1.promisify(this._web3.eth.sendTransaction)(txData)];\n                    case 1:\n                        txHash = _a.sent();\n                        return [2 /*return*/, txHash];\n                }\n            });\n        });\n    };\n    Web3Wrapper.prototype._sendRawPayloadAsync = function (payload) {\n        return __awaiter(this, void 0, void 0, function () {\n            var sendAsync, response, result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        sendAsync = this._web3.currentProvider.sendAsync.bind(this._web3.currentProvider);\n                        return [4 /*yield*/, utils_1.promisify(sendAsync)(payload)];\n                    case 1:\n                        response = _a.sent();\n                        result = response.result;\n                        return [2 /*return*/, result];\n                }\n            });\n        });\n    };\n    Web3Wrapper.prototype._normalizeTxReceiptStatus = function (status) {\n        // Transaction status might have four values\n        // undefined - Testrpc and other old clients\n        // null - New clients on old transactions\n        // number - Parity\n        // hex - Geth\n        if (_.isString(status)) {\n            return this._web3.toDecimal(status);\n        }\n        else if (_.isUndefined(status)) {\n            return null;\n        }\n        else {\n            return status;\n        }\n    };\n    Web3Wrapper.prototype._formatLog = function (rawLog) {\n        var formattedLog = __assign({}, rawLog, { logIndex: this._hexToDecimal(rawLog.logIndex), blockNumber: this._hexToDecimal(rawLog.blockNumber), transactionIndex: this._hexToDecimal(rawLog.transactionIndex) });\n        return formattedLog;\n    };\n    Web3Wrapper.prototype._hexToDecimal = function (hex) {\n        if (_.isNull(hex)) {\n            return null;\n        }\n        var decimal = this._web3.toDecimal(hex);\n        return decimal;\n    };\n    return Web3Wrapper;\n}());\nexports.Web3Wrapper = Web3Wrapper;\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"script"}