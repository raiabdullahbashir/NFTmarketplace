<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/animations/inertia.ts</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../index.html">All files</a> / <a href="index.html">src/animations</a> inertia.ts
    </h1>
    <div class='clearfix'>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import {
    InertiaOptions,
    PlaybackControls,
    AnimationOptions,
    SpringOptions,
} from "./types"
<span class="cstat-no" title="statement not covered" >import { animate } from "."</span>
<span class="cstat-no" title="statement not covered" >import { velocityPerSecond } from "../utils/velocity-per-second"</span>
<span class="cstat-no" title="statement not covered" >import { getFrameData } from "framesync"</span>
&nbsp;
export function <span class="fstat-no" title="function not covered" >inertia({</span>
<span class="branch-0 cbranch-no" title="branch not covered" >    from = 0,</span>
<span class="branch-0 cbranch-no" title="branch not covered" >    velocity = 0,</span>
    min,
    max,
<span class="branch-0 cbranch-no" title="branch not covered" >    power = 0.8,</span>
<span class="branch-0 cbranch-no" title="branch not covered" >    timeConstant = 750,</span>
<span class="branch-0 cbranch-no" title="branch not covered" >    bounceStiffness = 500,</span>
<span class="branch-0 cbranch-no" title="branch not covered" >    bounceDamping = 10,</span>
<span class="branch-0 cbranch-no" title="branch not covered" >    restDelta = 1,</span>
    modifyTarget,
    driver,
    onUpdate,
    onComplete,
}: InertiaOptions) {
    let currentAnimation: PlaybackControls
&nbsp;
    function <span class="fstat-no" title="function not covered" >isOutOfBounds(v: number) {</span>
<span class="cstat-no" title="statement not covered" >        return (min !== undefined &amp;&amp; v &lt; min) || (max !== undefined &amp;&amp; v &gt; max)</span>
    }
&nbsp;
    function <span class="fstat-no" title="function not covered" >boundaryNearest(v: number) {</span>
<span class="cstat-no" title="statement not covered" >        if (min === undefined) <span class="cstat-no" title="statement not covered" >r</span>eturn max</span>
<span class="cstat-no" title="statement not covered" >        if (max === undefined) <span class="cstat-no" title="statement not covered" >r</span>eturn min</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        return Math.abs(min - v) &lt; Math.abs(max - v) ? min : max</span>
    }
&nbsp;
    function <span class="fstat-no" title="function not covered" >startAnimation(options: AnimationOptions&lt;number&gt;) {</span>
<span class="cstat-no" title="statement not covered" >        currentAnimation?.stop()</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        currentAnimation = animate({</span>
            ...options,
            driver,
            onUpdate: <span class="fstat-no" title="function not covered" >(</span>v: number) =&gt; {
<span class="cstat-no" title="statement not covered" >                onUpdate?.(v)</span>
<span class="cstat-no" title="statement not covered" >                options.onUpdate?.(v)</span>
            },
            onComplete,
        })
    }
&nbsp;
    function <span class="fstat-no" title="function not covered" >startSpring(options: SpringOptions) {</span>
<span class="cstat-no" title="statement not covered" >        startAnimation({</span>
            type: "spring",
            stiffness: bounceStiffness,
            damping: bounceDamping,
            restDelta,
            ...options,
        })
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (isOutOfBounds(from)) {</span>
        // Start the animation with spring if outside the defined boundaries
<span class="cstat-no" title="statement not covered" >        startSpring({ from, velocity, to: boundaryNearest(from) })</span>
    } else {
        /**
         * Or if the value is out of bounds, simulate the inertia movement
         * with the decay animation.
         *
         * Pre-calculate the target so we can detect if it's out-of-bounds.
         * If it is, we want to check per frame when to switch to a spring
         * animation
         */
        let target = <span class="cstat-no" title="statement not covered" >power * velocity + from</span>
<span class="cstat-no" title="statement not covered" >        if (typeof modifyTarget !== "undefined") <span class="cstat-no" title="statement not covered" >t</span>arget = modifyTarget(target)</span>
        const boundary = <span class="cstat-no" title="statement not covered" >boundaryNearest(target)</span>
        const heading = <span class="cstat-no" title="statement not covered" >boundary === min ? -1 : 1</span>
        let prev: number
        let current: number
&nbsp;
        const checkBoundary = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >(</span>v: number) =&gt; {</span>
<span class="cstat-no" title="statement not covered" >            prev = current</span>
<span class="cstat-no" title="statement not covered" >            current = v</span>
<span class="cstat-no" title="statement not covered" >            velocity = velocityPerSecond(v - prev, getFrameData().delta)</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >            if (</span>
                (heading === 1 &amp;&amp; v &gt; boundary) ||
                (heading === -1 &amp;&amp; v &lt; boundary)
            ) {
<span class="cstat-no" title="statement not covered" >                startSpring({ from: v, to: boundary, velocity })</span>
            }
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        startAnimation({</span>
            type: "decay",
            from,
            velocity,
            timeConstant,
            power,
            restDelta,
            modifyTarget,
            onUpdate: isOutOfBounds(target) ? checkBoundary : undefined,
        })
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    return {</span>
        stop: <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >() =&gt; currentAnimation?.stop(),</span></span>
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Wed Sep 09 2020 17:11:16 GMT+0100 (British Summer Time)
</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
