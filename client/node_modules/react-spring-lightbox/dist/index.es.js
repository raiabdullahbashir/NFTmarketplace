import e,{useEffect as t,useRef as n,useState as r,useCallback as i}from"react";import o from"@babel/runtime/helpers/taggedTemplateLiteral";import a from"@babel/runtime/helpers/extends";import{animated as l,useSpring as s,to as c,useSprings as g,config as u,useTransition as d}from"@react-spring/web";import{useGesture as p}from"react-use-gesture";import m from"@babel/runtime/helpers/defineProperty";import h from"@babel/runtime/helpers/objectWithoutProperties";import f from"styled-components";import v from"react-dom";const y=e=>{var t;let{imageRef:n,scale:r,pinchDelta:i,touchOrigin:[o,a],currentTranslate:[l,s]}=e;if(null==n||!n.current)return[0,0];const{height:c,left:g,top:u,width:d}=null===(t=n.current)||void 0===t?void 0:t.getBoundingClientRect();return[-((o-g-d/2)/r)*i+l,-((a-u-c/2)/r)*i+s]},b=e=>{var t;if(!e.current)return!1;const{bottom:n,left:r,right:i,top:o}=null===(t=e.current)||void 0===t?void 0:t.getBoundingClientRect(),{innerHeight:a,innerWidth:l}=window;return r>.5*l||o>.5*a||i<.5*l||n<.5*a};var w;const x=["style"];function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const P={pinching:!1,scale:1,translateX:0,translateY:0},E=i=>{let{imgProps:{style:o},inline:l,isCurrentImage:g,pagerHeight:u,pagerIsDragging:d,setDisableDrag:m,singleClickToZoom:f}=i,v=h(i.imgProps,x);const[w,O]=r(!1),E=n(null),[{scale:k,translateX:T,translateY:j},N]=s((()=>C(C({},P),{},{onChange:(e,t)=>{(e.value.scale<1||!e.value.pinching)&&t.start(P),e.value.scale>1&&b(E)&&t.start(P)},onRest:(e,t)=>{1===e.value.scale&&(t.start(P),m(!1))}})));return t((()=>{g||1===k.get()||N.start(P)}),[g,k,N]),p({onDrag:e=>{let{movement:[t,n],pinching:r,cancel:i,first:o,memo:a={initialTranslateX:0,initialTranslateY:0},touches:l,tap:s}=e;if(!(d||1===k.get()||s||(t&&n&&!w&&O(!0),l>1||r||k.get()<=1)))return k.get()>1&&b(E)?void i():o?{initialTranslateX:T.get(),initialTranslateY:j.get()}:(N.start({translateX:a.initialTranslateX+t,translateY:a.initialTranslateY+n}),a)},onDragEnd:e=>{let{memo:t}=e;void 0!==t&&setTimeout((()=>O(!1)),100)},onPinch:e=>{let{movement:[t],origin:[n,r],event:i,ctrlKey:o,last:a,cancel:l}=e;if(d)return;if(m(!0),t&&!w&&O(!0),a)return void l();const s=o?1e3:250,c=k.get()+t/s,g=c-k.get();let u=[n,r];"clientX"in i&&"clientY"in i&&o&&(u=[i.clientX,i.clientY]);const[p,h]=y({currentTranslate:[T.get(),j.get()],imageRef:E,pinchDelta:g,scale:k.get(),touchOrigin:u});c<.5?N.start({pinching:!0,scale:.5}):c>3?N.start({pinching:!0,scale:3}):N.start({pinching:!0,scale:c,translateX:p,translateY:h})},onPinchEnd:()=>{d||(k.get()>1?m(!0):N.start(P),setTimeout((()=>O(!1)),100))}},{domTarget:E,drag:{filterTaps:!0},enabled:!l,eventOptions:{passive:!1}}),(e=>{let{ref:n,latency:r=300,enabled:i=!0,onSingleClick:o=(()=>null),onDoubleClick:a=(()=>null)}=e;t((()=>{const e=n.current;let t,l=0;const s=e=>{i&&(l+=1,t=setTimeout((()=>{1===l?o(e):2===l&&a(e),l=0}),r))};return null==e||e.addEventListener("click",s),()=>{null==e||e.removeEventListener("click",s),t&&clearTimeout(t)}}))})({[f?"onSingleClick":"onDoubleClick"]:e=>{if(d||w)return void e.stopPropagation();if(1!==k.get())return void N.start(P);const{clientX:t,clientY:n}=e,r=k.get()+1,i=r-k.get(),[o,a]=y({currentTranslate:[T.get(),j.get()],imageRef:E,pinchDelta:i,scale:k.get(),touchOrigin:[t,n]});m(!0),N.start({pinching:!0,scale:r,translateX:o,translateY:a})},enabled:!l,latency:f?0:200,ref:E}),e.createElement(D,a({$inline:l,className:"lightbox-image",draggable:"false",onClick:e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()},onDragStart:e=>{e.preventDefault()},ref:E,style:C(C({},o),{},{maxHeight:u,transform:c([k,T,j],((e,t,n)=>"translate(".concat(t,"px, ").concat(n,"px) scale(").concat(e,")")))},g&&{willChange:"transform"})},v))};E.displayName="Image";const D=f(l.img)(w||(w=o(["\n    width: auto;\n    height: auto;\n    max-width: 100%;\n    user-select: none;\n    touch-action: ",";\n    ::selection {\n        background: none;\n    }\n"])),(e=>{let{$inline:t}=e;return t?"pan-y":"none"}));var k,T,j,N,I;const L=i=>{let{currentIndex:o,images:l,imageStageHeight:s,imageStageWidth:c,inline:u,onClose:d,onNext:m,onPrev:h,renderImageOverlay:f,singleClickToZoom:v}=i;const y=n(!0),[b,w]=r(!1),[x,O]=r("100%"),[C,P]=r(!1);t((()=>{const e=u?s:s-50;e!==x&&O(e)}),[u,x,s]);const D=e.useCallback((function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=(e-o)*c+(t?n:0);return e<o-1||e>o+1?{display:"none",x:r}:{display:"flex",x:r}}),[o,c]),[k,T]=g(l.length,(e=>D(e)));t((()=>{y.current?y.current=!1:T.start((e=>D(e)))}),[o,D,T]);const j=p({onDrag:e=>{let{down:t,movement:[n],direction:[r],velocity:i,distance:o,cancel:a,active:l,touches:s,tap:g}=e;if(b||0===n||g)return;C||P(!0);const u=Math.abs(r)>.7;if((t&&u&&o>c/3.5||t&&u&&i>2)&&l){const e=r>0?-1:1;return a(),void(e>0?m():e<0&&h())}s>1?a():T.start((e=>D(e,t,n)))},onDragEnd:()=>{C&&(T.start((e=>D(e))),setTimeout((()=>P(!1)),100))},onWheel:e=>{let{velocity:t,direction:[n,r],ctrlKey:i}=e;if(i||b||0===t)return;C||P(!0);if(t>1.1){const e=n+r>0?-1:1;e>0?m():e<0&&h()}},onWheelEnd:()=>{T.start((e=>D(e))),setTimeout((()=>P(!1)),100)}},{drag:{filterTaps:!0},wheel:{enabled:!u}});return e.createElement(W,null,k.map(((t,n)=>{let{display:r,x:i}=t;return e.createElement(S,a({$inline:u},j(),{className:"lightbox-image-pager",key:n,onClick:()=>{if(d)return Math.abs(i.get())<1&&!b&&d()},role:"presentation",style:{display:r,transform:i.to((e=>"translateX(".concat(e,"px)")))}}),e.createElement(H,null,e.createElement(X,null,e.createElement(Y,{$inline:u,onClick:e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}},e.createElement(E,{imgProps:l[n],inline:u,isCurrentImage:n===o,pagerHeight:x,pagerIsDragging:C,setDisableDrag:w,singleClickToZoom:v}),f()))))})))};L.displayName="ImagePager";const W=f.div(k||(k=o(["\n    height: 100%;\n    width: 100%;\n"]))),X=f.div(T||(T=o(["\n    display: flex;\n    justify-content: center;\n    align-items: center;\n"]))),H=f.div(j||(j=o(["\n    width: 100%;\n    display: flex;\n    justify-content: center;\n"]))),S=f(l.div)(N||(N=o(["\n    position: absolute;\n    top: 0px;\n    left: 0px;\n    right: 0px;\n    bottom: 0px;\n    height: 100%;\n    width: 100%;\n    will-change: transform;\n    touch-action: ",";\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n"])),(e=>{let{$inline:t}=e;return t?"pan-y":"none"})),Y=f.div(I||(I=o(["\n    position: relative;\n    touch-action: ",";\n    user-select: none;\n    display: flex;\n    justify-content: center;\n    width: 100%;\n"])),(e=>{let{$inline:t}=e;return t?"pan-y":"none"}));var B;const R=o=>{let{className:a="",currentIndex:l,images:s,inline:c,onClose:g,onNext:u,onPrev:d,renderImageOverlay:p,renderNextButton:m,renderPrevButton:h,singleClickToZoom:f}=o;const v=l>0,y=l+1<s.length,b=y?u:()=>null,w=v?d:()=>null,[{height:x,width:O},C]=(()=>{var e,o;const a=n(null),[l,s]=r(null),[c,g]=r({height:(null===(e=a.current)||void 0===e?void 0:e.clientHeight)||0,width:(null===(o=a.current)||void 0===o?void 0:o.clientWidth)||0}),u=i((e=>{null!==e&&(s(e),g({height:e.clientHeight,width:e.clientWidth}))}),[]);return t((()=>{const e=()=>{if(l){const e=l.clientHeight,t=l.clientWidth;e===c.height&&t===c.width||g({height:e,width:t})}};return window.addEventListener("resize",e),window.addEventListener("orientationchange",e),()=>{window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e)}}),[l,c.height,c.width]),[c,u]})();return e.createElement(Z,{className:a,"data-testid":"lightbox-image-stage",ref:C},h({canPrev:v}),O&&e.createElement(L,{currentIndex:l,images:s,imageStageHeight:x,imageStageWidth:O,inline:c,onClose:g,onNext:b,onPrev:w,renderImageOverlay:p,singleClickToZoom:f}),m({canNext:y}))},Z=f.div(B||(B=o(["\n    position: relative;\n    height: 100%;\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n"])));var $;function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const z=t=>{let{children:n,className:r,isOpen:i,pageTransitionConfig:o,style:a}=t;const l={config:U(U({},u.default),{},{friction:32,mass:1,tension:320}),enter:{opacity:1,transform:"scale(1)"},from:{opacity:0,transform:"scale(0.75)"},leave:{opacity:0,transform:"scale(0.75)"}},s=d(i,U(U({},l),o));return e.createElement(e.Fragment,null,s(((t,i)=>i&&e.createElement(F,{className:"lightbox-container".concat(r?" ".concat(r):""),"data-testid":"lightbox-container",style:U(U({},t),a)},n))))},F=f(l.div)($||($=o(["\n    display: flex;\n    flex-direction: column;\n    position: fixed;\n    z-index: 400;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n"])));class M extends e.Component{constructor(){super(...arguments),m(this,"portalContainer",void 0),m(this,"body",void 0),m(this,"preventWheel",(e=>e.preventDefault()))}componentDidMount(){this.body=document.body,this.portalContainer=document.createElement("div"),this.portalContainer.setAttribute("class","lightbox-portal"),this.body.appendChild(this.portalContainer),this.forceUpdate(),this.portalContainer.addEventListener("wheel",this.preventWheel)}componentWillUnmount(){this.portalContainer.removeEventListener("wheel",this.preventWheel),this.body.removeChild(this.portalContainer)}render(){if(void 0===this.portalContainer)return null;const{children:t}=this.props;return e.createElement(e.Fragment,null,v.createPortal(t,this.portalContainer))}}const K=n=>{let{isOpen:r,onClose:i,inline:o=!1,images:a=[],currentIndex:l,onPrev:s,onNext:c,renderHeader:g=(()=>null),renderFooter:u=(()=>null),renderPrevButton:d=(()=>null),renderNextButton:p=(()=>null),renderImageOverlay:m=(()=>null),className:h="",singleClickToZoom:f=!1,style:v={},pageTransitionConfig:y=null}=n;t((()=>{const e=e=>{r&&["ArrowUp","ArrowDown","End","Home","PageUp","PageDown"].includes(e.key)&&e.preventDefault()},t=e=>{if(r)switch(e.key){case"ArrowLeft":s();break;case"ArrowRight":c();break;case"Escape":i&&i();break;default:e.preventDefault()}};return document.addEventListener("keyup",t),document.addEventListener("keydown",e),()=>{document.removeEventListener("keyup",t),document.removeEventListener("keydown",e)}}));const b=e.createElement(R,{currentIndex:l,images:a,inline:o,onClose:i,onNext:c,onPrev:s,renderImageOverlay:m,renderNextButton:p,renderPrevButton:d,singleClickToZoom:f});return o?b:e.createElement(M,null,e.createElement(z,{className:h,isOpen:r,pageTransitionConfig:y,style:v},g(),b,u()))};export{K as default};
//# sourceMappingURL=index.es.js.map
